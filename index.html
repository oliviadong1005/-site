<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <!-- 让手机浏览器按真实像素渲染，允许横竖屏切换 -->
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=yes" />
  <title>张沛林 — 主页</title>

  <!-- 统一暗色极简风格 + 响应式 -->
  <style>
    /* 全局样式 */
    html,body{
      margin:0;
      padding:0;
      font-family:"Noto Sans SC","Microsoft YaHei",sans-serif;
      background:#0f1724;
      color:#e6f0f2;
      min-height:100vh;
    }

    /* 居中容器，移动端也友好 */
    .wrapper{
      max-width:680px;
      margin:0 auto;
      padding:2rem 1rem;
      box-sizing:border-box;
    }

    h1{margin:.2em 0 .6em;font-size:1.8rem;}

    /* 头像 */
    .avatar{
      max-width:180px;
      border-radius:12px;
      margin:16px 0;
    }

    /* 按钮链接 */
    .btn{
      display:block;
      padding:14px 20px;
      background:#1e293b;
      color:#6ee7b7;
      text-decoration:none;
      border-radius:8px;
      margin:10px 0;
      font-size:1rem;
      text-align:center;
      transition:.2s;
    }
    .btn:hover{background:#334155;}

    /* Cbox 区域 */
    #cbox-wrapper{
      width:100%;
      margin-top:2rem;
    }
    #cbox-iframe{
      width:100%;
      height:60vh;          /* 手机竖屏占 60% 视口高度 */
      border:1px solid #334155;
      border-radius:8px;
      background:#fff;      /* Cbox 本身白底，避免黑框 */
    }

    /* 电脑端加大高度 */
    @media (min-width:768px){
      #cbox-iframe{height:480px;}
    }
  </style>
</head>

<body>
  <div class="wrapper">
    <h1>张沛林 — 主页</h1>

    <img class="avatar" src="avatar.jpg" alt="张沛林头像">

    <p>张沛林是一款人工智能助手。</p>

    <a class="btn" href="zhangpeilin.html">张沛林</a>
    <a class="btn" href="huoqu.html">如何获取软件</a>
    <a class="btn" href="match3.html">张沛林消消乐</a>


    <!-- ===== Cbox 聊天室 ===== -->
<!-- 触发按钮 -->
<button id="toggleChat" class="btn">打开聊天室</button>

<!-- 聊天室容器，初始隐藏 -->
<div id="cbox-wrapper" style="display:none">
  <iframe id="cbox-iframe"
          src="about:blank"
          data-src="https://www3.cbox.ws/box/?boxid=3548406&boxtag=YWZJ56"
          width="100%"
          height="480"
          frameborder="0"
          scrolling="auto">
  </iframe>
</div>

<script>
  (function () {
    const btn   = document.getElementById('toggleChat');
    const wrap  = document.getElementById('cbox-wrapper');
    const ifr   = document.getElementById('cbox-iframe');

    btn.addEventListener('click', function () {
      const isHidden = wrap.style.display === 'none';
      if (isHidden) {                 // → 展开
        if (ifr.src === 'about:blank') {
          ifr.src = ifr.dataset.src;  // 首次加载
        }
        wrap.style.display = 'block';
        btn.textContent = '收起聊天室';
      } else {                        // → 折叠
        wrap.style.display = 'none';
        btn.textContent = '打开聊天室';
      }
    });
  })();
</script>
<!-- 聊天框 -->
<!-- zpl 聊天区 -->
<div id="chat" style="margin-top:40px;max-width:600px;">
  <div id="messages" style="border:1px solid #ccc;height:200px;overflow-y:auto;padding:6px;"></div>
  <input id="input" placeholder="和张沛林聊聊…" style="width:70%;padding:4px;">
  <button id="sendBtn" style="width:25%;">发送</button>
</div>

<script>
const API_KEY = 'sk-9OTVzZThhOSJdwmtA5nogwI7PFQlUgxuPAGDnM1rGixmdEvm';

const messagesEl = document.getElementById('messages');
const inputEl    = document.getElementById('input');
const sendBtn    = document.getElementById('sendBtn');

const addMsg = (who, text) => {
  const div = document.createElement('div');
  div.textContent = `${who}: ${text}`;
  messagesEl.appendChild(div);
  messagesEl.scrollTop = messagesEl.scrollHeight;
};

sendBtn.onclick = async () => {
  const text = inputEl.value.trim();
  if (!text) return;
  addMsg('你', text);
  inputEl.value = '';

  const res = await fetch('https://api.moonshot.cn/v1/chat/completions', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      Authorization: `Bearer ${API_KEY}`
    },
    body: JSON.stringify({
      model: 'moonshot-v1-8k',
      messages: [
        { role: 'system', content: '你是张沛林，回答较为温柔，不知道发什么的时候就回一个qiep或者Emoji，回答简洁。' },
        { role: 'user',   content: text }
      ]
    })
  });
  const data = await res.json();
  const reply = data.choices?.[0]?.message?.content || '出错了 😅';
  addMsg('zpl', reply);
};
</script>

</body>
</html>
